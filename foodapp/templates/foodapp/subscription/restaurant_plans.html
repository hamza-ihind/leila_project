{% extends "foodapp/base.html" %}
{% load static %}

{% block title %}Plans d'abonnement Restaurant | FoodFlex{% endblock %}
{% block page_title %}Plans d'abonnement Restaurant{% endblock %}

{% block extra_css %}
<style>
    .pricing-header {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .pricing-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--text-color);
    }
    
    .pricing-header p {
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.7);
        max-width: 800px;
        margin: 20px auto;
    }
    
    .pricing-tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 40px;
    }
    
    .pricing-toggle {
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 30px;
        padding: 5px;
        display: inline-flex;
        position: relative;
    }
    
    .pricing-toggle-button {
        padding: 10px 20px;
        border-radius: 25px;
        border: none;
        background: transparent;
        color: rgba(255, 255, 255, 0.7);
        cursor: pointer;
        font-weight: 500;
        z-index: 1;
        position: relative;
    }
    
    .pricing-toggle-button.active {
        color: #fff;
    }
    
    .pricing-toggle-slider {
        position: absolute;
        top: 5px;
        left: 5px;
        height: calc(100% - 10px);
        width: calc(50% - 10px);
        background-color: var(--primary-color);
        border-radius: 25px;
        transition: transform 0.3s ease;
    }
    
    .pricing-toggle-slider.yearly {
        transform: translateX(100%);
    }
    
    .save-text {
        display: inline-block;
        background-color: rgba(46, 204, 113, 0.15);
        color: #2ecc71;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 14px;
        margin-left: 10px;
        font-weight: 500;
    }
    
    .pricing-plans-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .pricing-plan-card {
        background-color: var(--card-bg);
        border-radius: 15px;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .pricing-plan-card.featured {
        transform: translateY(-10px) scale(1.03);
        border: 1px solid var(--primary-color);
        box-shadow: 0 10px 30px rgba(255, 107, 107, 0.2);
        z-index: 1;
    }
    
    .pricing-plan-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    .pricing-plan-card.featured:hover {
        transform: translateY(-15px) scale(1.03);
    }
    
    .pricing-plan-header {
        padding: 25px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        position: relative;
    }
    
    .plan-badge {
        position: absolute;
        top: 15px;
        right: 15px;
        background-color: var(--primary-color);
        color: #fff;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
    }
    
    .plan-name {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 10px;
    }
    
    .plan-description {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
        margin-bottom: 20px;
    }
    
    .plan-price {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        color: #fff;
    }
    
    .plan-price .currency {
        font-size: 1.2rem;
        position: relative;
        top: -10px;
        margin-right: 2px;
    }
    
    .plan-price .period {
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.7);
        font-weight: 400;
    }
    
    .plan-features {
        padding: 25px;
        margin: 0;
        list-style: none;
    }
    
    .plan-features li {
        margin-bottom: 15px;
        padding-left: 30px;
        position: relative;
        color: rgba(255, 255, 255, 0.9);
        font-size: 0.95rem;
    }
    
    .plan-features li:before {
        content: "✓";
        position: absolute;
        left: 0;
        color: var(--primary-color);
        font-weight: 700;
    }
    
    .plan-features li.unavailable {
        color: rgba(255, 255, 255, 0.5);
        text-decoration: line-through;
    }
    
    .plan-features li.unavailable:before {
        content: "✗";
        color: rgba(255, 255, 255, 0.3);
    }
    
    .plan-footer {
        padding: 25px;
        text-align: center;
    }
    
    .plan-button {
        display: block;
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff;
        font-weight: 600;
        text-align: center;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .plan-button:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }
    
    .plan-button.primary {
        background-color: var(--primary-color);
    }
    
    .plan-button.primary:hover {
        background-color: var(--primary-color-hover);
        transform: translateY(-2px);
        box-shadow: 0 5px 10px rgba(255, 107, 107, 0.3);
    }
    
    .current-plan-tag {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        background-color: #2ecc71;
        color: #fff;
        text-align: center;
        padding: 8px 0;
        font-weight: 600;
        font-size: 14px;
    }
    
    .faq-section {
        margin-top: 80px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .faq-header {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .faq-header h2 {
        font-size: 2rem;
        font-weight: 700;
    }
    
    .faq-item {
        margin-bottom: 20px;
        background-color: var(--card-bg);
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .faq-question {
        padding: 20px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .faq-question:after {
        content: "+";
        font-size: 1.5rem;
        transition: transform 0.3s ease;
    }
    
    .faq-question.active:after {
        content: "-";
    }
    
    .faq-answer {
        padding: 0 20px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease, padding 0.3s ease;
    }
    
    .faq-answer.active {
        padding: 0 20px 20px;
        max-height: 500px;
    }
    
    .popular-badge {
        position: absolute;
        top: -12px;
        right: 20px;
        background-color: #f39c12;
        color: #fff;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 12px;
        z-index: 2;
    }
</style>
{% endblock %}

{% block content %}
<div class="app-content">
    <div class="breadcrumb">
        <a href="{% url 'accueil' %}">Accueil</a>
        <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
        <span>Plans d'abonnement restaurant</span>
    </div>
    
    <div class="pricing-header">
        <h1>Boostez Votre Visibilité Restaurant</h1>
        <p>Choisissez le plan qui correspond le mieux à vos besoins et attirez plus de clients vers votre restaurant</p>
        
        <div class="pricing-tabs">
            <div class="pricing-toggle">
                <div id="pricing-toggle-slider" class="pricing-toggle-slider"></div>
                <button id="monthly-toggle" class="pricing-toggle-button active">Mensuel</button>
                <button id="yearly-toggle" class="pricing-toggle-button">Annuel <span class="save-text">-20%</span></button>
            </div>
        </div>
    </div>
    
    <div class="pricing-plans-container">
        {% for plan in plans %}
            <div class="pricing-plan-card {% if plan.is_featured %}featured{% endif %}">
                {% if plan.is_featured %}
                    <div class="popular-badge">Plan Populaire</div>
                {% endif %}
                
                {% if current_plan and current_plan.id == plan.id %}
                    <div class="current-plan-tag">Votre plan actuel</div>
                {% endif %}
                
                <div class="pricing-plan-header">
                    {% if plan.badge_text %}
                        <div class="plan-badge">{{ plan.badge_text }}</div>
                    {% endif %}
                    
                    <h2 class="plan-name">{{ plan.name }}</h2>
                    <p class="plan-description">{{ plan.description }}</p>
                    
                    <div class="plan-price monthly-price">
                        <span class="currency">€</span>{{ plan.price_monthly }}
                        <span class="period">/mois</span>
                    </div>
                    
                    <div class="plan-price yearly-price" style="display: none;">
                        <span class="currency">€</span>{{ plan.price_yearly }}
                        <span class="period">/an</span>
                    </div>
                </div>
                
                <ul class="plan-features">
                    {% for feature_name, feature_value in plan.features.items %}
                        {% if feature_value == True or feature_value >= 0 %}
                            <li>
                                {% if feature_name == 'listing_visibility' %}
                                    Visibilité {{ feature_value }}
                                {% elif feature_name == 'max_dishes' %}
                                    {% if feature_value == -1 %}
                                        Plats illimités
                                    {% else %}
                                        {{ feature_value }} plats maximum
                                    {% endif %}
                                {% elif feature_name == 'reservations' %}
                                    Système de réservation
                                {% elif feature_name == 'analytics' %}
                                    Statistiques et analyse
                                {% elif feature_name == 'featured_listing' %}
                                    Mise en avant dans les recherches
                                {% elif feature_name == 'support' %}
                                    Support {{ feature_value }}
                                {% elif feature_name == 'reviews_management' %}
                                    Gestion des avis
                                {% elif feature_name == 'profile_customization' %}
                                    Personnalisation {{ feature_value }}
                                {% elif feature_name == 'discount_codes' %}
                                    Codes promotionnels
                                {% elif feature_name == 'marketing_tools' %}
                                    Outils marketing
                                {% elif feature_name == 'featured_in_search' %}
                                    Restaurant mis en avant
                                {% elif feature_name == 'api_access' %}
                                    Accès API
                                {% elif feature_name == 'dedicated_account_manager' %}
                                    Gestionnaire de compte dédié
                                {% else %}
                                    {{ feature_name }}: {{ feature_value }}
                                {% endif %}
                            </li>
                        {% else %}
                            <li class="unavailable">
                                {% if feature_name == 'listing_visibility' %}
                                    Visibilité premium
                                {% elif feature_name == 'analytics' %}
                                    Statistiques et analyse
                                {% elif feature_name == 'featured_listing' %}
                                    Mise en avant dans les recherches
                                {% elif feature_name == 'reviews_management' %}
                                    Gestion des avis
                                {% elif feature_name == 'discount_codes' %}
                                    Codes promotionnels
                                {% elif feature_name == 'marketing_tools' %}
                                    Outils marketing
                                {% elif feature_name == 'featured_in_search' %}
                                    Restaurant mis en avant
                                {% elif feature_name == 'api_access' %}
                                    Accès API
                                {% elif feature_name == 'dedicated_account_manager' %}
                                    Gestionnaire de compte dédié
                                {% else %}
                                    {{ feature_name }}
                                {% endif %}
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if plan.max_listings > 1 %}
                        <li>{{ plan.max_listings }} restaurants maximum</li>
                    {% endif %}
                </ul>
                
                <div class="plan-footer">
                    {% if current_plan and current_plan.id == plan.id %}
                        <button class="plan-button" disabled>Plan actuel</button>
                    {% elif plan.name == 'Free' %}
                        <a href="{% url 'subscription_checkout' plan_type='restaurant' plan_id=plan.id %}" class="plan-button">
                            Commencer gratuitement
                        </a>
                    {% else %}
                        <a href="{% url 'subscription_checkout' plan_type='restaurant' plan_id=plan.id %}" class="plan-button {% if plan.is_featured %}primary{% endif %}">
                            Choisir ce plan
                        </a>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>
    
    <div class="faq-section">
        <div class="faq-header">
            <h2>Questions fréquentes</h2>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Comment changer de plan ?</div>
            <div class="faq-answer">
                <p>Vous pouvez changer de plan à tout moment. Si vous passez à un plan supérieur, la différence de prix sera calculée au prorata. Si vous passez à un plan inférieur, le changement prendra effet à la fin de votre période de facturation actuelle.</p>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Puis-je annuler mon abonnement ?</div>
            <div class="faq-answer">
                <p>Oui, vous pouvez annuler votre abonnement à tout moment. Le plan restera actif jusqu'à la fin de la période de facturation en cours. Aucun remboursement n'est effectué pour les périodes partiellement utilisées.</p>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Y a-t-il des frais supplémentaires ?</div>
            <div class="faq-answer">
                <p>Non, il n'y a aucun frais caché. Le prix affiché est le prix que vous paierez. Vous pouvez choisir entre une facturation mensuelle ou annuelle.</p>
            </div>
        </div>
        
        <div class="faq-item">
            <div class="faq-question">Comment fonctionne la mise en avant ?</div>
            <div class="faq-answer">
                <p>Avec les plans Premium et Professionnel, votre restaurant apparaît en haut des résultats de recherche et bénéficie d'une visibilité accrue sur notre plateforme. Cela inclut également des badges distinctifs et des recommandations spéciales pour les utilisateurs.</p>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle pour le cycle de facturation (mensuel/annuel)
        const monthlyToggle = document.getElementById('monthly-toggle');
        const yearlyToggle = document.getElementById('yearly-toggle');
        const toggleSlider = document.getElementById('pricing-toggle-slider');
        const monthlyPrices = document.querySelectorAll('.monthly-price');
        const yearlyPrices = document.querySelectorAll('.yearly-price');
        
        monthlyToggle.addEventListener('click', function() {
            monthlyToggle.classList.add('active');
            yearlyToggle.classList.remove('active');
            toggleSlider.classList.remove('yearly');
            
            // Afficher les prix mensuels
            monthlyPrices.forEach(price => price.style.display = 'block');
            yearlyPrices.forEach(price => price.style.display = 'none');
            
            // Mettre à jour les URLs des boutons
            updateCheckoutUrls('monthly');
        });
        
        yearlyToggle.addEventListener('click', function() {
            yearlyToggle.classList.add('active');
            monthlyToggle.classList.remove('active');
            toggleSlider.classList.add('yearly');
            
            // Afficher les prix annuels
            monthlyPrices.forEach(price => price.style.display = 'none');
            yearlyPrices.forEach(price => price.style.display = 'block');
            
            // Mettre à jour les URLs des boutons
            updateCheckoutUrls('yearly');
        });
        
        // Gestion des FAQ
        const faqQuestions = document.querySelectorAll('.faq-question');
        
        faqQuestions.forEach(question => {
            question.addEventListener('click', function() {
                const answer = this.nextElementSibling;
                const isActive = this.classList.contains('active');
                
                // Fermer toutes les réponses
                document.querySelectorAll('.faq-question').forEach(q => q.classList.remove('active'));
                document.querySelectorAll('.faq-answer').forEach(a => a.classList.remove('active'));
                
                // Si la réponse n'était pas déjà active, l'ouvrir
                if (!isActive) {
                    this.classList.add('active');
                    answer.classList.add('active');
                }
            });
        });
        
        // Fonction pour mettre à jour les URLs des boutons de checkout
        function updateCheckoutUrls(billingCycle) {
            const checkoutButtons = document.querySelectorAll('.plan-button');
            
            checkoutButtons.forEach(button => {
                if (button.href && button.href.includes('checkout')) {
                    // Extrait l'URL de base
                    const baseUrl = button.href.split('?')[0];
                    button.href = `${baseUrl}?billing=${billingCycle}`;
                }
            });
        }
    });
</script>
{% endblock %} 